#include <shared.h>

#include <iostream>

int main()
{
    const unsigned char payload[] {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
        0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,
        0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27,
        0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f,
        0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37,
        0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,
    };

    const unsigned char serialized[] {
        // DAT
        0x00, 0x00, 0x00, 0x00,

        // Sequence number
        0x00, 0x00, 0x00, 0x01,

        // Packet length
        0x00, 0x00, 0x00, 0x4c,

        // Payload
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
        0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,
        0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27,
        0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f,
        0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37,
        0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,
    };

    a3::Packet packet = a3::create_packet(a3::DAT, 1, &payload[0], sizeof(payload) * sizeof(payload[0]));
    std::string log_string = a3::packet_to_log_string(packet, a3::SEND);
    std::cout << log_string << '\n';

    const unsigned char *serialized_test = a3::serialize_packet(packet);
    std::cout << std::memcmp(&serialized[0], &serialized_test[0], packet.length) << '\n';
    std::cout << a3::equal_packets(packet, a3::deserialize_packet(serialized_test)) << '\n';
    delete[] serialized_test;

    packet = a3::create_ack(1);
    log_string = a3::packet_to_log_string(packet, a3::RECV);
    std::cout << log_string << '\n';

    packet = a3::create_eot();
    log_string = a3::packet_to_log_string(packet, a3::SEND);
    std::cout << log_string << '\n';

    return 0;
}
